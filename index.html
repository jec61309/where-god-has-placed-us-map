<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Where God Has Placed Us</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }

    #map {
      height: 100vh;
      width: 100%;
    }

    #map-legend {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(255,255,255,0.95);
      padding: 10px 12px;
      border-radius: 8px;
      font-size: 14px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.25);
      z-index: 99999;
    }

    #map-legend div {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
    }

    #map-legend div:last-child {
      margin-bottom: 0;
    }

    #map-legend img {
      width: 18px;
      height: 18px;
      margin-right: 8px;
    }
  </style>
</head>

<body>

<div id="map"></div>

<div id="map-legend">
  <div><img src="https://maps.google.com/mapfiles/ms/icons/blue-dot.png"> Live</div>
  <div><img src="https://maps.google.com/mapfiles/ms/icons/green-dot.png"> Work / School</div>
  <div><img src="https://maps.google.com/mapfiles/ms/icons/orange-dot.png"> Play</div>
  <div>⭐ GNC Sunday Gathering</div>
</div>

<script>
  const SHEET_ID = "1JnsbsIui3DZrxczAANMYyp3qun05kR-98ZmHZIC-ECE";
  const SHEET_NAME = "Form Responses 1";

  const CHURCH_LOCATION = { lat: 42.0511, lng: -82.58783 };

  let map;

  function initMap() {
    map = new google.maps.Map(document.getElementById("map"), {
      center: CHURCH_LOCATION,
      zoom: 12,
      mapTypeControl: false
    });

    // ⭐ Church marker
    new google.maps.Marker({
      position: CHURCH_LOCATION,
      map,
      title: "GNC Sunday Gathering",
      icon: {
        path: google.maps.SymbolPath.STAR,
        scale: 10,
        fillColor: "#FFD700",
        fillOpacity: 1,
        strokeColor: "#333",
        strokeWeight: 1
      }
    });

    loadSheetData();

    setTimeout(() => {
      google.maps.event.trigger(map, "resize");
    }, 400);
  }

  function loadSheetData() {
    const url =
      `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(SHEET_NAME)}`;

    fetch(url)
      .then(res => res.text())
      .then(text => {
        const json = JSON.parse(text.substring(47).slice(0, -2));
        json.table.rows.forEach(row => {
          const type = row.c[2]?.v;
          const lat = row.c[4]?.v;
          const lng = row.c[5]?.v;
          if (!type || !lat || !lng) return;

          let icon;
          if (type === "Live") icon = "https://maps.google.com/mapfiles/ms/icons/blue-dot.png";
          if (type === "Work/School") icon = "https://maps.google.com/mapfiles/ms/icons/green-dot.png";
          if (type === "Play") icon = "https://maps.google.com/mapfiles/ms/icons/orange-dot.png";

          new google.maps.Marker({
            position: { lat, lng },
            map,
            icon
          });
        });
      });
  }
</script>

<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC86YnNhyUyQtgOJX7PC0uQ5SUQGdUv7qs&callback=initMap"
  async
  defer>
</script>

</body>
</html>
